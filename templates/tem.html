<!DOCTYPE html>
<html>
<head>
    <title>Prognosys: Cardio Risk</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .glass-header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 20px;
        }
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { 
            width: 100%; padding: 15px; background: #3498db; color: white; 
            border: none; border-radius: 8px; font-size: 18px; cursor: pointer; transition: 0.3s;
        }
        button:hover { background: #2980b9; }
        #result-box { display: none; text-align: center; padding: 20px; color: white; border-radius: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="glass-header">
        <h1>ðŸ«€ Enhanced Cardiovascular Risk Assessment</h1>
    </div>

    <div class="card">
        <h3>Patient Data</h3>
        <div class="input-grid">
            <div><label>Age</label><input type="number" id="age" value="40"></div>
            <div><label>Sex</label><select id="sex"><option>Male</option><option>Female</option></select></div>
            <div><label>Systolic BP</label><input type="number" id="systolic_bp" value="120"></div>
            <div><label>Diastolic BP</label><input type="number" id="diastolic_bp" value="80"></div>
            <div><label>Heart Rate</label><input type="number" id="heart_rate" value="75"></div>
            <div><label>Troponin</label><input type="number" id="troponin" value="0.02" step="0.01"></div>
            <div><label>Total Chol</label><input type="number" id="total_cholesterol" value="160"></div>
            <div><label>LDL</label><input type="number" id="ldl_cholesterol" value="100"></div>
            <div><label>HDL</label><input type="number" id="hdl_cholesterol" value="50"></div>
            <div><label>Triglycerides</label><input type="number" id="triglycerides" value="150"></div>
        </div>
        <br>
        <button onclick="calculateRisk()">ðŸ”„ Calculate Comprehensive Risk</button>
    </div>

    <div id="result-section" style="display:none;">
        <div id="result-box">
            <h2 id="risk-level-text"></h2>
            <h1 id="score-text" style="font-size: 48px; margin: 10px 0;"></h1>
        </div>

        <div class="card">
            <div id="chart-container"></div>
        </div>
    </div>
</div>

<script>
    async function calculateRisk() {
        // 1. Gather Data
        const data = {
            age: parseInt(document.getElementById('age').value),
            sex: document.getElementById('sex').value,
            systolic_bp: parseInt(document.getElementById('systolic_bp').value),
            diastolic_bp: parseInt(document.getElementById('diastolic_bp').value),
            heart_rate: parseInt(document.getElementById('heart_rate').value),
            troponin: parseFloat(document.getElementById('troponin').value),
            total_cholesterol: parseInt(document.getElementById('total_cholesterol').value),
            ldl_cholesterol: parseInt(document.getElementById('ldl_cholesterol').value),
            hdl_cholesterol: parseInt(document.getElementById('hdl_cholesterol').value),
            triglycerides: parseInt(document.getElementById('triglycerides').value)
        };

        // 2. Send to Python
        const response = await fetch('/calculate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        // 3. Show Results
        document.getElementById('result-section').style.display = 'block';
        
        // Update Text
        const box = document.getElementById('result-box');
        box.style.display = 'block';
        box.style.background = result.color;
        
        document.getElementById('risk-level-text').innerText = `${result.level_emoji} ${result.level}`;
        document.getElementById('score-text').innerText = `${result.score}/35`;

        // 4. Render the EXACT Python Chart
        // We parse the JSON graph sent from Python and give it to Plotly.js
        const graphData = JSON.parse(result.graphJSON);
        Plotly.newPlot('chart-container', graphData.data, graphData.layout);
    }
</script>

</body>
</html>